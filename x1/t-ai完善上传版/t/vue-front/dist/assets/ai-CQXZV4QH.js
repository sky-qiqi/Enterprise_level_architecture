import{_ as b,r as v,c as l,o as c,b as d,a,d as f,w as y,a3 as I,F as x,e as k,af as C,ag as w,ah as M,ai as T,aj as V,H as m}from"./index-B6q5g7tU.js";import{_ as u}from"./header-nSCF0jj9.js";/* empty css                     */import"./bg-2-DQ5WRs7S.js";const B="/assets/Ai-B-7Fqnzp.png",L={name:"AiChat",components:{Header:u},data(){return{msgValue:"",msgDom:null,userImg:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png",aiImg:B,uploadedImage:null}},computed:{messageList(){return this.$store.state.msg.list||[]}},mounted(){this.msgDom=document.getElementById("message-box"),this.scroll(),window.copyCode=t=>{const i=t.closest(".code-block").querySelector("code").textContent;navigator.clipboard.writeText(i).then(()=>{this.$message({message:"代码已复制到剪贴板",type:"success",duration:2e3}),t.innerHTML='<i class="el-icon-check"></i>',setTimeout(()=>{t.innerHTML='<i class="el-icon-document-copy"></i>'},2e3)}).catch(r=>{this.$message.error("复制失败，请手动复制"),console.error("复制失败:",r)})}},methods:{scroll(){this.$nextTick(()=>{this.msgDom&&(this.msgDom.scrollTop=this.msgDom.scrollHeight)})},handleImageUpload(t){const e=t.target.files[0];if(e){if(!e.type.startsWith("image/")){this.$message.error("请上传图片文件");return}const i=new FileReader;i.onload=r=>{this.uploadedImage=r.target.result,this.$message.success("图片已选择")},i.readAsDataURL(e)}},async submitMsg(){if(!this.msgValue.trim()&&!this.uploadedImage){this.$message.warning("请输入文本或选择图片");return}this.$store.dispatch("msg/userAddMsg",{text:this.msgValue||"请描述图片内容",image:this.uploadedImage}),await this.$store.dispatch("msg/aiAddMsg",{text:this.msgValue||"请描述图片内容",image:this.uploadedImage}),this.msgValue="",this.uploadedImage=null,this.$refs.imageInput.value="",this.scroll()},clearChat(){this.$confirm("确认清除所有对话记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.$store.commit("msg/CLEAR_MESSAGES"),this.$message({type:"success",message:"对话已清除"}),this.scroll()}).catch(()=>{this.$message({type:"info",message:"已取消清除"})})},processCodeBlocks(t){return t&&(t=t.replace(/<pre><code.*?>([\s\S]*?)<\/code><\/pre>/g,(e,i)=>`
          <div class="code-block">
            <div class="code-header">
              <button class="copy-button" onclick="copyCode(this)">
                <i class="el-icon-document-copy"></i>
              </button>
            </div>
            <pre><code>${i}</code></pre>
          </div>
        `),t=t.replace(/<pre><code class="language-.*?">([\s\S]*?)<\/code><\/pre>/g,(e,i)=>`
          <div class="code-block">
            <div class="code-header">
              <button class="copy-button" onclick="copyCode(this)">
                <i class="el-icon-document-copy"></i>
              </button>
            </div>
            ${e}
          </div>
        `),t)}},watch:{messageList:{handler(){this.scroll()},deep:!0}}},A={class:"ai-chat"},D={class:"chat-container"},H={class:"action-bar"},$={class:"message-container",id:"message-box"},E={class:"message-content"},S={class:"avatar"},U=["src","alt"],F={key:0,class:"assistant-name"},N={class:"bubble"},R=["src"],q=["innerHTML"],z={class:"input-area"};function K(t,e,i,r,n,o){const g=u,h=v("Delete"),p=I;return c(),l("div",null,[d(g),a("div",A,[a("div",D,[a("div",H,[a("button",{class:"clear-button",onClick:e[0]||(e[0]=(...s)=>o.clearChat&&o.clearChat(...s))},[d(p,null,{default:y(()=>[d(h)]),_:1}),e[5]||(e[5]=f(" 清除对话内容 "))])]),a("div",$,[(c(!0),l(x,null,k(o.messageList,(s,_)=>(c(),l("div",{key:_,class:V(["message",s.role==="user"?"message-user":"message-assistant"])},[a("div",E,[a("div",S,[a("img",{src:s.role==="user"?n.userImg:n.aiImg,alt:s.role==="user"?"用户":"AI",class:"avatar-img"},null,8,U),s.role==="assistant"?(c(),l("span",F,"豆包AI")):m("",!0)]),a("div",N,[s.role==="user"&&s.image?(c(),l("img",{key:0,src:s.image,alt:"Uploaded image",class:"uploaded-image"},null,8,R)):m("",!0),a("div",{class:"text",innerHTML:s.content||"暂无内容"},null,8,q)])])],2))),128))]),a("div",z,[C(a("textarea",{class:"message-input",rows:"3",placeholder:"请输入您的问题...","onUpdate:modelValue":e[1]||(e[1]=s=>n.msgValue=s),onKeydown:e[2]||(e[2]=M(T((...s)=>o.submitMsg&&o.submitMsg(...s),["prevent"]),["enter"]))},null,544),[[w,n.msgValue]]),a("input",{type:"file",accept:"image/*",onChange:e[3]||(e[3]=(...s)=>o.handleImageUpload&&o.handleImageUpload(...s)),class:"image-upload",ref:"imageInput"},null,544),a("button",{class:"send-button",onClick:e[4]||(e[4]=(...s)=>o.submitMsg&&o.submitMsg(...s))}," 发送 ")])])])])}const O=b(L,[["render",K],["__scopeId","data-v-bfc60713"]]);export{O as default};
