import{_ as P,r as L,c as a,o,b as l,a as i,f as y,w as c,F as v,e as C,h as N,t as h,d as u,j as O,H as g,E as T,I as B,J as E,P as U,K as H,Q as A,R as M,S,T as F,i as q,q as J}from"./index-B6q5g7tU.js";/* empty css                  *//* empty css                        *//* empty css                     *//* empty css                  *//* empty css               *//* empty css                         */import{_ as j}from"./ai-C_6kPfeB.js";import{_ as K}from"./header-nSCF0jj9.js";import{b as Q}from"./bottom-DTrEwoYQ.js";import"./bg-2-DQ5WRs7S.js";const R={headers:K,bottoms:Q},G={components:R,data(){return{id:"",date1:new Date,dialogVisible:!1,search:{attractionsId:"",pageSize:10,pageNumber:1},info:{name:"",price:0,num:0,realName:0,introduce:"",content:"",open:"",time:"",images:null},total:0,tableData:[],content:"",num:1,people:[{name:"",tel:"",idCard:""}],isLoading:!1,pickerOptions:{disabledDate(t){return t.getTime()<Date.now()-864e5}}}},methods:{saveComments(){if(!this.content||this.content.trim()===""){this.$message.warning("请输入评论内容");return}if(!this.id){this.$message.error("缺少景点ID，无法评论");return}const t={content:this.content.trim(),attractionsId:this.id};F(t).then(e=>{e.code===1e3?(this.$message({message:"评论成功",type:"success"}),this.content="",this.search.pageNumber=1,this.getCommentsPage()):this.$message.warning(e.msg||"评论失败")}).catch(e=>{console.error("API request failed for saveComments:",e),this.$message.error("评论请求出错")})},getCommentsPage(){if(!this.id){console.warn("ID is not set for getCommentsPage"),this.tableData=[],this.total=0;return}this.search.attractionsId=this.id,S(this.search).then(t=>{t.code===1e3&&t.data&&Array.isArray(t.data.records)?(this.tableData=t.data.records,this.total=typeof t.data.total=="number"?t.data.total:0):(console.error("Error fetching comments:",t.msg||"Unknown error",t),this.$message.error(t.msg||"获取评论列表失败"),this.tableData=[],this.total=0)}).catch(t=>{console.error("API request failed for getCommentsPage:",t),this.$message.error("获取评论列表请求出错"),this.tableData=[],this.total=0})},closeOrder(){this.date1="",this.num=1,this.people=[{name:"",tel:"",idCard:""}],this.dialogVisible=!1},saveOrder(){if(!this.date1){this.$message.warning("请选择预约日期");return}if(!this.num||this.num<1){this.$message.warning("请输入有效的预约数量");return}if(this.people.length!==this.num){this.people.length<this.num?this.$message.warning(`请填写 ${this.num} 位预约人的信息`):this.$message.warning(`预约人信息超出预约数量，请填写 ${this.num} 位预约人信息`);return}for(let e=0;e<this.people.length;e++){const r=this.people[e];if(!r.name||r.name.trim()===""){this.$message.warning(`请完善第 ${e+1} 位预约人的姓名`);return}if(!r.tel||r.tel.trim()===""){this.$message.warning(`请完善第 ${e+1} 位预约人的联系方式`);return}if(this.info.realName===1&&(!r.idCard||r.idCard.trim()==="")){this.$message.warning(`请完善第 ${e+1} 位预约人的证件号`);return}}if(!this.id){this.$message.error("缺少景点ID，无法创建订单");return}const t={attractionsId:this.id,num:this.num,time:this.date1,people:JSON.stringify(this.people)};M(t).then(e=>{e.code===1e3?(this.$message({message:"预约成功，请等待确认",type:"success"}),this.closeOrder()):this.$message.warning(e.msg||"预定失败")}).catch(e=>{this.$message.error("预定请求出错")})},getAttractionsById(){if(!this.id){console.error("景点ID不存在"),this.$message.error("景点ID不存在，请返回列表页重新选择");return}this.isLoading=!0,A({id:this.id}).then(t=>{this.isLoading=!1,t.code===1e3&&t.data?(this.info=t.data,this.normalizeInfoData()):(this.$message.error(t.msg||"获取景点信息失败"),console.error("获取景点信息失败:",t))}).catch(t=>{this.isLoading=!1,this.$message.error("网络错误，请稍后重试"),console.error("获取景点信息请求出错:",t)})},isInfoLoaded(){return this.info&&typeof this.info.realName<"u"&&typeof this.info.num<"u"&&this.info.num>0},normalizeInfoData(){this.info.price=parseFloat(this.info.price)||0,this.info.num=parseInt(this.info.num)||0,this.info.realName=parseInt(this.info.realName)||0,this.info.images||(this.info.images="")},toOrder(){if(this.isLoading){this.$message.warning("数据加载中，请稍候");return}if(!this.isInfoLoaded()){this.$message.warning("景点信息不完整，无法预约"),this.getAttractionsById();return}this.resetOrderForm(),this.dialogVisible=!0},resetOrderForm(){this.num=1,this.date1=new Date,this.people=[{name:"",tel:"",idCard:""}]},handleNumChange(t){if(t<this.people.length)this.people.splice(t);else if(t>this.people.length){const e=Math.min(t-this.people.length,3-this.people.length);for(let r=0;r<e;r++)this.people.push({name:"",tel:"",idCard:""})}},addPerson(){this.people.length<3?this.people.push({name:"",tel:"",idCard:""}):this.$message.warning("最多只能添加3位预约人")},removePerson(t){this.people.length>1&&(this.people.splice(t,1),this.people.length<this.num&&(this.num=this.people.length))},handleCurrentChange(t){this.search.pageNumber=t,this.getCommentsPage()}},mounted(){const t=this.$route.query.id;t?(this.id=t,this.getAttractionsById(),this.getCommentsPage()):this.$message.error("缺少商品ID，无法显示详情")}},W={class:"attractionsInfo"},X={class:"attractionsInfo1"},Y={class:"attractionsInfo2"},Z={class:"attractionsInfo3"},$=["src"],ee={key:1,style:{width:"100%",height:"100%","background-color":"#e9e9e9","text-align":"center","line-height":"500px"}},te={key:1},se={key:2},ie={class:"attractionsInfo4"},ne={class:"attractionsInfo5"},oe={key:0,class:"attractionsInfo5"},ae={key:1,class:"attractionsInfo5"},le={style:{"margin-left":"20px","margin-top":"10px"}},re=["innerHTML"],me={class:"attractionsInfo7"},de={class:"attractionsInfo1"},he={class:"attractionsInfo8"},ce=["innerHTML"],pe=["innerHTML"],ge=["innerHTML"],ue={class:"attractionsInfo1"},fe={class:"attractionsInfo8"},_e={style:{display:"flex","align-items":"center"}},ye={class:"forum1",style:{width:"100%"}},ve=["src"],Ce={class:"comment-info"},xe={class:"comment-author"},Ie={class:"comment-content"},ke={key:0,style:{"text-align":"center","margin-top":"20px"}},Ve={style:{display:"flex","align-items":"center","margin-bottom":"10px"}},be={class:"people-container"},De={class:"person-header"},we={class:"input-group"},ze={key:0,class:"action-buttons"},Pe=["onClick"],Le={key:0,style:{"margin-top":"10px",color:"#909399","font-size":"12px"}},Ne={slot:"footer",class:"dialog-footer"};function Oe(t,e,r,Te,s,m){const x=j,I=L("headers"),k=N,V=q,f=O,_=T,b=J,D=B,w=E,z=H;return o(),a("div",W,[l(x),l(I),i("div",X,[i("div",Y,[i("div",Z,[s.info.images&&s.info.images.length>0?(o(),y(V,{key:0,height:"500px"},{default:c(()=>[(o(!0),a(v,null,C(s.info.images.split(","),(n,d)=>(o(),y(k,{key:d},{default:c(()=>[n?(o(),a("img",{key:0,style:{width:"100%",height:"100%"},src:n},null,8,$)):(o(),a("div",ee," 无效图片链接 "))]),_:2},1024))),128))]),_:1})):!s.info.images&&s.id?(o(),a("div",te," 正在加载图片... ")):(o(),a("div",se," 暂无图片 "))]),i("div",ie,[i("div",ne,h(s.info.name),1),s.info.price!==void 0?(o(),a("div",oe,"价格："+h(s.info.price)+"（元）",1)):(o(),a("div",ae,"加载中...")),i("div",le,"库存："+h(s.info.num)+" - "+h(s.info.realName==0?"非实名":"实名"),1),i("div",{class:"attractionsInfo6",innerHTML:s.info.introduce},null,8,re),i("div",me,[l(f,{size:"small",type:"primary",plain:"",onClick:m.toOrder,style:{"font-size":"18px"}},{default:c(()=>e[5]||(e[5]=[u("立即预约")])),_:1,__:[5]},8,["onClick"])])])])]),i("div",de,[i("div",he,[i("div",{style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px"},innerHTML:s.info.content},null,8,ce),i("div",{style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px"},innerHTML:s.info.open},null,8,pe),i("div",{style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px"},innerHTML:s.info.time},null,8,ge)])]),i("div",ue,[i("div",fe,[e[7]||(e[7]=i("h2",{style:{"margin-left":"10px"}},"评论",-1)),i("div",_e,[l(_,{style:{flex:"1","margin-right":"10px","margin-left":"10px"},modelValue:s.content,"onUpdate:modelValue":e[0]||(e[0]=n=>s.content=n),type:"textarea",rows:"1",placeholder:"请输入评论内容"},null,8,["modelValue"]),l(f,{style:{"margin-top":"0","margin-right":"10px","font-size":"16px"},type:"primary",size:"small",plain:"",onClick:m.saveComments},{default:c(()=>e[6]||(e[6]=[u(" 发表评论 ")])),_:1,__:[6]},8,["onClick"])]),i("div",ye,[(o(!0),a(v,null,C(s.tableData,(n,d)=>(o(),a("div",{class:"forum2",key:d},[i("img",{class:"avatar",src:t.$store.state.HOST+n.avatar},null,8,ve),i("div",Ce,[i("div",xe,h(n.createBy),1),i("div",Ie,h(n.content),1)])]))),128)),!s.tableData||s.tableData.length===0?(o(),a("div",ke,"暂无评论")):g("",!0)]),s.total>s.search.pageSize?(o(),y(b,{key:0,background:"","page-size":s.search.pageSize,layout:"prev, pager, next",onCurrentChange:m.handleCurrentChange,total:s.total},null,8,["page-size","onCurrentChange","total"])):g("",!0)])]),l(z,{title:"预约",modelValue:s.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=n=>s.dialogVisible=n),width:"40%"},{default:c(()=>[i("div",Ve,[l(D,{size:"small",modelValue:s.num,"onUpdate:modelValue":e[1]||(e[1]=n=>s.num=n),min:1,max:3,onChange:m.handleNumChange},null,8,["modelValue","onChange"]),l(w,{size:"small",style:{"margin-left":"20px"},modelValue:s.date1,"onUpdate:modelValue":e[2]||(e[2]=n=>s.date1=n),type:"date",placeholder:"选择预约日期","picker-options":s.pickerOptions},null,8,["modelValue","picker-options"])]),i("div",be,[(o(!0),a(v,null,C(s.people,(n,d)=>(o(),a("div",{class:"person-item",key:"person-"+d,style:U({marginBottom:d===s.people.length-1?"0":"10px"})},[i("div",De," 预约人 "+h(d+1),1),i("div",we,[l(_,{size:"small",modelValue:n.name,"onUpdate:modelValue":p=>n.name=p,placeholder:"请输入姓名",style:{"margin-right":"10px",flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(_,{size:"small",modelValue:n.tel,"onUpdate:modelValue":p=>n.tel=p,placeholder:"请输入电话",style:{"margin-right":"10px",flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),s.info.realName===1?(o(),y(_,{key:0,size:"small",modelValue:n.idCard,"onUpdate:modelValue":p=>n.idCard=p,placeholder:"请输入身份证号",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"])):g("",!0)]),s.people.length>1?(o(),a("div",ze,[i("i",{class:"el-icon-remove-outline",onClick:p=>m.removePerson(d),style:{color:"red","margin-left":"10px",cursor:"pointer"}},null,8,Pe)])):g("",!0)],4))),128)),s.people.length<s.num&&s.people.length<3?(o(),a("div",{key:0,class:"add-button",onClick:e[3]||(e[3]=n=>m.addPerson()),style:{color:"#409eff",cursor:"pointer","margin-top":"10px"}},e[8]||(e[8]=[i("i",{class:"el-icon-circle-plus-outline"},null,-1),u(" 添加预约人 ")]))):g("",!0)]),s.num>0?(o(),a("div",Le," 请填写 "+h(s.num)+" 位预约人的信息 ",1)):g("",!0),i("span",Ne,[l(f,{onClick:m.closeOrder,size:"small"},{default:c(()=>e[9]||(e[9]=[u("取 消")])),_:1,__:[9]},8,["onClick"]),l(f,{type:"primary",onClick:m.saveOrder,size:"small"},{default:c(()=>e[10]||(e[10]=[u("确 定")])),_:1,__:[10]},8,["onClick"])])]),_:1},8,["modelValue"])])}const Ke=P(G,[["render",Oe],["__scopeId","data-v-58aded28"]]);export{Ke as default};
