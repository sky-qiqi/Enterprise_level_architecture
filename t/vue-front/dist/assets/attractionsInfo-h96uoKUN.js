import{_ as L,r as P,c as a,o,b as l,a as i,j as y,w as c,F as v,s as C,D as N,t as h,e as u,H as O,k as g,d as B,Y as T,Z as U,q as E,$ as H,a4 as M,a5 as A,a6 as S,a7 as F,M as q,G as j,Q as G}from"./index-PRjfuCQ0.js";/* empty css                  *//* empty css                        */import{_ as J}from"./header-D64wlt_7.js";/* empty css                  *//* empty css               *//* empty css                         */import{_ as Q}from"./ai-BsaaMcx6.js";import{b as Y}from"./bottom-BK5Rfpdu.js";import"./bg-2-DQ5WRs7S.js";const Z={headers:J,bottoms:Y},K={computed:{$store(){return q}},components:Z,data(){return{id:"",date1:new Date,dialogVisible:!1,search:{attractionsId:"",pageSize:10,pageNumber:1},info:{name:"",price:0,num:0,realName:0,introduce:"",content:"",open:"",time:"",images:null},total:0,tableData:[],content:"",num:1,people:[{name:"",tel:"",idCard:""}],isLoading:!1,pickerOptions:{disabledDate(s){return s.getTime()<Date.now()-864e5}}}},methods:{saveComments(){if(!this.content||this.content.trim()===""){this.$message.warning("请输入评论内容");return}if(!this.id){this.$message.error("缺少景点ID，无法评论");return}const s={content:this.content.trim(),attractionsId:this.id};F(s).then(e=>{e.code===1e3?(this.$message({message:"评论成功",type:"success"}),this.content="",this.search.pageNumber=1,this.getCommentsPage()):this.$message.warning(e.msg||"评论失败")}).catch(e=>{console.error("API request failed for saveComments:",e),this.$message.error("评论请求出错")})},getCommentsPage(){if(!this.id){console.warn("ID is not set for getCommentsPage"),this.tableData=[],this.total=0;return}this.search.attractionsId=this.id,S(this.search).then(s=>{s.code===1e3&&s.data&&Array.isArray(s.data.records)?(this.tableData=s.data.records,this.total=typeof s.data.total=="number"?s.data.total:0):(console.error("Error fetching comments:",s.msg||"Unknown error",s),this.$message.error(s.msg||"获取评论列表失败"),this.tableData=[],this.total=0)}).catch(s=>{console.error("API request failed for getCommentsPage:",s),this.$message.error("获取评论列表请求出错"),this.tableData=[],this.total=0})},closeOrder(){this.date1="",this.num=1,this.people=[{name:"",tel:"",idCard:""}],this.dialogVisible=!1},saveOrder(){if(!this.date1){this.$message.warning("请选择预约日期");return}if(!this.num||this.num<1){this.$message.warning("请输入有效的预约数量");return}if(this.people.length!==this.num){this.people.length<this.num?this.$message.warning(`请填写 ${this.num} 位预约人的信息`):this.$message.warning(`预约人信息超出预约数量，请填写 ${this.num} 位预约人信息`);return}for(let e=0;e<this.people.length;e++){const r=this.people[e];if(!r.name||r.name.trim()===""){this.$message.warning(`请完善第 ${e+1} 位预约人的姓名`);return}if(!r.tel||r.tel.trim()===""){this.$message.warning(`请完善第 ${e+1} 位预约人的联系方式`);return}if(this.info.realName===1&&(!r.idCard||r.idCard.trim()==="")){this.$message.warning(`请完善第 ${e+1} 位预约人的证件号`);return}}if(!this.id){this.$message.error("缺少景点ID，无法创建订单");return}const s={attractionsId:this.id,num:this.num,time:this.date1,people:JSON.stringify(this.people)};A(s).then(e=>{e.code===1e3?(this.$message({message:"预约成功，请等待确认",type:"success"}),this.closeOrder()):this.$message.warning(e.msg||"预定失败")}).catch(e=>{this.$message.error("预定请求出错")})},getAttractionsById(){if(!this.id){console.error("景点ID不存在"),this.$message.error("景点ID不存在，请返回列表页重新选择");return}this.isLoading=!0,M({id:this.id}).then(s=>{this.isLoading=!1,s.code===1e3&&s.data?(this.info=s.data,this.normalizeInfoData()):(this.$message.error(s.msg||"获取景点信息失败"),console.error("获取景点信息失败:",s))}).catch(s=>{this.isLoading=!1,this.$message.error("网络错误，请稍后重试"),console.error("获取景点信息请求出错:",s)})},isInfoLoaded(){return this.info&&typeof this.info.realName<"u"&&typeof this.info.num<"u"&&this.info.num>0},normalizeInfoData(){this.info.price=parseFloat(this.info.price)||0,this.info.num=parseInt(this.info.num)||0,this.info.realName=parseInt(this.info.realName)||0,this.info.images||(this.info.images="")},toOrder(){if(this.isLoading){this.$message.warning("数据加载中，请稍候");return}if(!this.isInfoLoaded()){this.$message.warning("景点信息不完整，无法预约"),this.getAttractionsById();return}this.resetOrderForm(),this.dialogVisible=!0},resetOrderForm(){this.num=1,this.date1=new Date,this.people=[{name:"",tel:"",idCard:""}]},handleNumChange(s){if(s<this.people.length)this.people.splice(s);else if(s>this.people.length){const e=Math.min(s-this.people.length,3-this.people.length);for(let r=0;r<e;r++)this.people.push({name:"",tel:"",idCard:""})}},addPerson(){this.people.length<3?this.people.push({name:"",tel:"",idCard:""}):this.$message.warning("最多只能添加3位预约人")},removePerson(s){this.people.length>1&&(this.people.splice(s,1),this.people.length<this.num&&(this.num=this.people.length))},handleCurrentChange(s){this.search.pageNumber=s,this.getCommentsPage()}},mounted(){const s=this.$route.query.id;s?(this.id=s,this.getAttractionsById(),this.getCommentsPage()):this.$message.error("缺少商品ID，无法显示详情")}},R={class:"attractionsInfo"},W={class:"attractionsInfo1"},X={class:"attractionsInfo2"},$={class:"attractionsInfo3"},ee=["src"],te={key:1,style:{width:"100%",height:"100%","background-color":"#e9e9e9","text-align":"center","line-height":"500px"}},se={key:1},ie={key:2},ne={class:"attractionsInfo4"},oe={class:"attractionsInfo5"},ae={key:0,class:"attractionsInfo5"},le={key:1,class:"attractionsInfo5"},re={style:{"margin-left":"20px","margin-top":"10px"}},me=["innerHTML"],de={class:"attractionsInfo7"},he={class:"attractionsInfo1"},ce={class:"attractionsInfo8"},pe=["innerHTML"],ge=["innerHTML"],ue=["innerHTML"],fe={class:"attractionsInfo1"},_e={class:"attractionsInfo8"},ye={style:{display:"flex","align-items":"center"}},ve={class:"forum1",style:{width:"100%"}},Ce=["src"],xe={class:"comment-info"},Ie={class:"comment-author"},ke={class:"comment-content"},Ve={key:0,style:{"text-align":"center","margin-top":"20px"}},be={style:{display:"flex","align-items":"center","margin-bottom":"10px"}},De={class:"people-container"},we={class:"person-header"},ze={class:"input-group"},Le={key:0,class:"action-buttons"},Pe=["onClick"],Ne={key:0,style:{"margin-top":"10px",color:"#909399","font-size":"12px"}},Oe={slot:"footer",class:"dialog-footer"};function Be(s,e,r,Te,t,m){const x=Q,I=P("headers"),k=N,V=j,f=O,_=B,b=G,D=T,w=U,z=H;return o(),a("div",R,[l(x),l(I),i("div",W,[i("div",X,[i("div",$,[t.info.images&&t.info.images.length>0?(o(),y(V,{key:0,height:"500px"},{default:c(()=>[(o(!0),a(v,null,C(t.info.images.split(","),(n,d)=>(o(),y(k,{key:d},{default:c(()=>[n?(o(),a("img",{key:0,style:{width:"100%",height:"100%"},src:n},null,8,ee)):(o(),a("div",te," 无效图片链接 "))]),_:2},1024))),128))]),_:1})):!t.info.images&&t.id?(o(),a("div",se," 正在加载图片... ")):(o(),a("div",ie," 暂无图片 "))]),i("div",ne,[i("div",oe,h(t.info.name),1),t.info.price!==void 0?(o(),a("div",ae,"价格："+h(t.info.price)+"（元）",1)):(o(),a("div",le,"加载中...")),i("div",re,"库存："+h(t.info.num)+" - "+h(t.info.realName==0?"非实名":"实名"),1),i("div",{class:"attractionsInfo6",innerHTML:t.info.introduce},null,8,me),i("div",de,[l(f,{size:"small",type:"primary",plain:"",onClick:m.toOrder,style:{"font-size":"18px"}},{default:c(()=>e[5]||(e[5]=[u("立即预约")])),_:1,__:[5]},8,["onClick"])])])])]),i("div",he,[i("div",ce,[i("div",{style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px"},innerHTML:t.info.content},null,8,pe),i("div",{style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px"},innerHTML:t.info.open},null,8,ge),i("div",{style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px"},innerHTML:t.info.time},null,8,ue)])]),i("div",fe,[i("div",_e,[e[7]||(e[7]=i("h2",{style:{"margin-left":"10px"}},"评论",-1)),i("div",ye,[l(_,{style:{flex:"1","margin-right":"10px","margin-left":"10px"},modelValue:t.content,"onUpdate:modelValue":e[0]||(e[0]=n=>t.content=n),type:"textarea",rows:"1",placeholder:"请输入评论内容"},null,8,["modelValue"]),l(f,{style:{"margin-top":"0","margin-right":"10px","font-size":"16px"},type:"primary",size:"small",plain:"",onClick:m.saveComments},{default:c(()=>e[6]||(e[6]=[u(" 发表评论 ")])),_:1,__:[6]},8,["onClick"])]),i("div",ve,[(o(!0),a(v,null,C(t.tableData,(n,d)=>(o(),a("div",{class:"forum2",key:d},[i("img",{class:"avatar",src:m.$store.state.HOST+n.avatar},null,8,Ce),i("div",xe,[i("div",Ie,h(n.createBy),1),i("div",ke,h(n.content),1)])]))),128)),!t.tableData||t.tableData.length===0?(o(),a("div",Ve,"暂无评论")):g("",!0)]),t.total>t.search.pageSize?(o(),y(b,{key:0,background:"","page-size":t.search.pageSize,layout:"prev, pager, next",onCurrentChange:m.handleCurrentChange,total:t.total},null,8,["page-size","onCurrentChange","total"])):g("",!0)])]),l(z,{title:"预约",modelValue:t.dialogVisible,"onUpdate:modelValue":e[4]||(e[4]=n=>t.dialogVisible=n),width:"40%"},{default:c(()=>[i("div",be,[l(D,{size:"small",modelValue:t.num,"onUpdate:modelValue":e[1]||(e[1]=n=>t.num=n),min:1,max:3,onChange:m.handleNumChange},null,8,["modelValue","onChange"]),l(w,{size:"small",style:{"margin-left":"20px"},modelValue:t.date1,"onUpdate:modelValue":e[2]||(e[2]=n=>t.date1=n),type:"date",placeholder:"选择预约日期","picker-options":t.pickerOptions},null,8,["modelValue","picker-options"])]),i("div",De,[(o(!0),a(v,null,C(t.people,(n,d)=>(o(),a("div",{class:"person-item",key:"person-"+d,style:E({marginBottom:d===t.people.length-1?"0":"10px"})},[i("div",we," 预约人 "+h(d+1),1),i("div",ze,[l(_,{size:"small",modelValue:n.name,"onUpdate:modelValue":p=>n.name=p,placeholder:"请输入姓名",style:{"margin-right":"10px",flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),l(_,{size:"small",modelValue:n.tel,"onUpdate:modelValue":p=>n.tel=p,placeholder:"请输入电话",style:{"margin-right":"10px",flex:"1"}},null,8,["modelValue","onUpdate:modelValue"]),t.info.realName===1?(o(),y(_,{key:0,size:"small",modelValue:n.idCard,"onUpdate:modelValue":p=>n.idCard=p,placeholder:"请输入身份证号",style:{flex:"1"}},null,8,["modelValue","onUpdate:modelValue"])):g("",!0)]),t.people.length>1?(o(),a("div",Le,[i("i",{class:"el-icon-remove-outline",onClick:p=>m.removePerson(d),style:{color:"red","margin-left":"10px",cursor:"pointer"}},null,8,Pe)])):g("",!0)],4))),128)),t.people.length<t.num&&t.people.length<3?(o(),a("div",{key:0,class:"add-button",onClick:e[3]||(e[3]=n=>m.addPerson()),style:{color:"#409eff",cursor:"pointer","margin-top":"10px"}},e[8]||(e[8]=[i("i",{class:"el-icon-circle-plus-outline"},null,-1),u(" 添加预约人 ")]))):g("",!0)]),t.num>0?(o(),a("div",Ne," 请填写 "+h(t.num)+" 位预约人的信息 ",1)):g("",!0),i("span",Oe,[l(f,{onClick:m.closeOrder,size:"small"},{default:c(()=>e[9]||(e[9]=[u("取 消")])),_:1,__:[9]},8,["onClick"]),l(f,{type:"primary",onClick:m.saveOrder,size:"small"},{default:c(()=>e[10]||(e[10]=[u("确 定")])),_:1,__:[10]},8,["onClick"])])]),_:1},8,["modelValue"])])}const Je=L(K,[["render",Be],["__scopeId","data-v-1b82fa86"]]);export{Je as default};
